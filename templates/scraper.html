{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Please see the article */

#editing, #highlighting {
  /* Both elements need the same text and space styling so they are directly on top of each other */
  margin: 10px;
  padding: 10px;
  border: 0;
  width: calc(100% - 32px);
  height: 700px;
}
#editing, #highlighting, #highlighting * {
  /* Also add text styles to highlighing tokens */
  font-size: 15pt;
  font-family: monospace;
  line-height: 20pt;
  tab-size: 2;
}


#editing, #highlighting {
  /* In the same place */
  position: absolute;
  top: 100;
  left: 0;
}

</style>

<section class="mt-5 card text-center">
    <div class="container">
        <h2>Scraper WJEC for microsolft Docs</h2>
        <form class="admin-form" method="POST" enctype="multipart/form-data" action="">
            {% csrf_token %}
        <div class="input-group mb-3">
            <input type="file" class="form-control"  id="myFile" name="filename" id="inputGroupFile02" multiple>
          </div>
            <!-- submit button -->
            <div class="mb-3">
                <input class="btn my_hover user_button_sm" type="submit" value="submit file">
            </div>
        </form>
           <!-- submit button -->
           <div class="mb-3">
            <button class="btn btn-success" onclick="copy()">Copy Json file </button>
        </div>

        <p style="margin-top: 50px;">
            <textarea placeholder="" id="editing" spellcheck="false" oninput="update(this.value); sync_scroll(this);" onscroll="sync_scroll(this);" onkeydown="check_tab(this, event);">{{dic}}</textarea>
        </p>
    </div>
</section>

<script>
// copy from the textearea
function copy() {
  let textarea = document.getElementById("editing");
  textarea.select();
  document.execCommand("copy");
}


// HTML CSS JSResult Skip Results Iframe
// EDIT ON
function update(text) {
  let result_element = document.querySelector("#highlighting-content");
  // Handle final newlines (see article)
  if(text[text.length-1] == "\n") {
    text += " ";
  }
  // Update code
  result_element.innerHTML = text.replace(new RegExp("&", "g"), "&amp;").replace(new RegExp("<", "g"), "&lt;"); /* Global RegExp */
  // Syntax Highlight
  Prism.highlightElement(result_element);
}

function sync_scroll(element) {
  /* Scroll result to scroll coords of event - sync with textarea */
  let result_element = document.querySelector("#highlighting");
  // Get and set x and y
  result_element.scrollTop = element.scrollTop;
  result_element.scrollLeft = element.scrollLeft;
}

function check_tab(element, event) {
  let code = element.value;
  if(event.key == "Tab") {
    /* Tab key pressed */
    event.preventDefault(); // stop normal
    let before_tab = code.slice(0, element.selectionStart); // text before tab
    let after_tab = code.slice(element.selectionEnd, element.value.length); // text after tab
    let cursor_pos = element.selectionStart + 1; // where cursor moves after tab - moving forward by 1 char to after tab
    element.value = before_tab + "\t" + after_tab; // add tab char
    // move cursor
    element.selectionStart = cursor_pos;
    element.selectionEnd = cursor_pos;
    update(element.value); // Update text to include indent
  }
}
</script>
{% endblock content %}